---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\matt\publications\jop2\webpage\interaction1.log
  log type:  text
 opened on:   6 Jan 2013, 21:12:55

. set more off;

. *     ***************************************************************** *;
. *     ***************************************************************** *;
. *       File-Name:      interaction1.do                                 *;
. *       Date:           1/6/2013                                        *;
. *       Author:         MG                                              *;
. *       Purpose:        Do-file to produce a marginal effect plot for   *;
. *                       X when the interaction model is:                *;
. *                       Y = b0 + b1X + b2Z + b3XZ + e                   *;
. *       Input File:     alexseev.dta                                    *;
. *       Output File:    interaction1.log                                *;
. *       Data Output:    None                                            *;
. *       Previous file:  None                                            *;
. *       Machine:        laptop                                          *;
. *     ****************************************************************  *;
. *     ****************************************************************  *;
. use "C:\matt\publications\jop2\webpage\alexseev.dta", clear;

. *     ****************************************************************  *;
. *     ****************************************************************  *;
. *         Get stuff ready to produce a marginal effect for X.               *;
. *     ****************************************************************  *;
. *     ****************************************************************  *;
. set obs 10000;
obs was 74, now 10000

. regress xenovote slavicshare changenonslav slavicshare_changenonslav inc9903 eduhi02 unemp02 apt9200 vsall03 brdcont, cluster(region);

Linear regression                                      Number of obs =      72
                                                       F(  9,    71) =   12.73
                                                       Prob > F      =  0.0000
                                                       R-squared     =  0.6584
                                                       Root MSE      =  2.1625

                                (Std. Err. adjusted for 72 clusters in region)
------------------------------------------------------------------------------
             |               Robust
    xenovote |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 slavicshare |   .0314862   .0221473     1.42   0.160    -.0126744    .0756467
changenons~v |  -.8511076   .3219924    -2.64   0.010    -1.493142   -.2090731
slavicshar~v |   .0082259   .0046716     1.76   0.083    -.0010889    .0175407
     inc9903 |   .0002343   .0001919     1.22   0.226    -.0001484     .000617
     eduhi02 |   -.039512   .0112821    -3.50   0.001    -.0620079   -.0170162
     unemp02 |   1.432013   .6353786     2.25   0.027     .1651037    2.698922
     apt9200 |   .0301246   .0355113     0.85   0.399     -.040683    .1009321
     vsall03 |   .6611627   .3315158     1.99   0.050     .0001389    1.322186
     brdcont |   2.103688   .6523309     3.22   0.002     .8029772    3.404399
       _cons |   8.942878   3.173843     2.82   0.006     2.614415    15.27134
------------------------------------------------------------------------------

. matrix b=e(b);

. matrix V=e(V);

. scalar b1=b[1,1];

. scalar b3=b[1,3];

. scalar varb1=V[1,1];

. scalar varb3=V[3,3];

. scalar covb1b3=V[1,3];

. scalar list b1 b3 varb1 varb3 covb1b3;
        b1 =  .03148617
        b3 =  .00822591
     varb1 =   .0004905
     varb3 =  .00002182
   covb1b3 = -.00005822

. *     ****************************************************************  *;
. *       Calculate data necessary for top marginal effect plot.          *;
. *     ****************************************************************  *;
. generate MVZ=((_n-200)/100);

. replace  MVZ=. if _n>1501;
(8499 real changes made, 8499 to missing)

. gen conbx=b1+b3*MVZ if _n<1501;
(8500 missing values generated)

. gen consx=sqrt(varb1+varb3*(MVZ^2)+2*covb1b3*MVZ) if _n<1501;
(8500 missing values generated)

. gen ax=1.96*consx;
(8500 missing values generated)

. gen upperx=conbx+ax;
(8500 missing values generated)

. gen lowerx=conbx-ax;
(8500 missing values generated)

. *     ****************************************************************  *;
. *       Construct stuff to produce the rug plot.  Need to create an     *;
. *       offset position for the pipe marker, which will depend on       *;
. *       where the histogram sits on the y-axis. This will requie some   *;
. *       trial and error.                                                *;
. *     ****************************************************************  *;
. gen where=-0.045;

. gen pipe = "|";

. egen tag_nonslav = tag(changenonslav);

. *     ****************************************************************  *;
. *       Construct variable to produce y=0 line.                         *;
. *     ****************************************************************  *;
. gen yline=0;

. *     ****************************************************************  *;
. *     ****************************************************************  *;
. *       Produce marginal effect plot for X.                             *;
. *     ****************************************************************  *;
. *     ****************************************************************  *;
. graph twoway hist changenonslav, width(0.5) percent color(gs14) yaxis(2)
>                 ||   scatter where changenonslav if tag_nonslav, plotr(m(b 4)) ms(none) mlabcolor(gs5) mlabel(pipe) mlabpos(6) legend(off)
>             ||   line conbx   MVZ, clpattern(solid) clwidth(medium) clcolor(black) yaxis(1)
>         ||   line upperx  MVZ, clpattern(dash) clwidth(thin) clcolor(black)
>         ||   line lowerx  MVZ, clpattern(dash) clwidth(thin) clcolor(black)
>         ||   line yline  MVZ,  clwidth(thin) clcolor(black) clpattern(solid)
>             ||   ,
>              xlabel(-2 0 2 4 6 8 10 12, nogrid labsize(2))
>                      ylabel(-0.05 0 .05 .1 .15 .2 .25, axis(1) nogrid labsize(2))
>                      ylabel(0 2 4 6 8 10 12 14 16, axis(2) nogrid labsize(2))
>                  yscale(noline alt)
>                      yscale(noline alt axis(2)) 
>              xscale(noline)
>              legend(off)
>              xtitle("" , size(2.5)  )
>              ytitle("" , axis(2) size(2.5))
>              xsca(titlegap(2))
>              ysca(titlegap(2))
>                          scheme(s2mono) graphregion(fcolor(white) ilcolor(white) lcolor(white));

. log close;
      name:  <unnamed>
       log:  C:\matt\publications\jop2\webpage\interaction1.log
  log type:  text
 closed on:   6 Jan 2013, 21:12:59
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
